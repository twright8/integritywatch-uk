{"id":"tab_a.js","dependencies":[{"name":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\package.json","includedInParent":true,"mtime":1712741236801},{"name":"jquery","loc":{"line":6,"column":23,"index":130},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\node_modules\\jquery\\dist\\jquery.js"},{"name":"jquery-ui-bundle","loc":{"line":9,"column":8,"index":191},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\node_modules\\jquery-ui-bundle\\jquery-ui.js"},{"name":"jquery-ui-bundle/jquery-ui.css","loc":{"line":10,"column":8,"index":220},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\node_modules\\jquery-ui-bundle\\jquery-ui.css"},{"name":"datatables.net","loc":{"line":11,"column":9,"index":264},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\node_modules\\datatables.net\\js\\jquery.dataTables.js"},{"name":"datatables.net-dt","loc":{"line":12,"column":9,"index":306},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\node_modules\\datatables.net-dt\\js\\dataTables.dataTables.js"},{"name":"underscore","loc":{"line":14,"column":23,"index":367},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\node_modules\\underscore\\underscore.js"},{"name":"../public/vendor/js/popper.min.js","loc":{"line":18,"column":7,"index":448},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\public\\vendor\\js\\popper.min.js"},{"name":"../public/vendor/js/bootstrap.min.js","loc":{"line":19,"column":7,"index":492},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\public\\vendor\\js\\bootstrap.min.js"},{"name":"d3-request","loc":{"line":21,"column":21,"index":587},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\node_modules\\d3-request\\index.js"},{"name":"../public/vendor/css/bootstrap.min.css","loc":{"line":23,"column":7,"index":610},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\public\\vendor\\css\\bootstrap.min.css"},{"name":"../public/vendor/css/dc.css","loc":{"line":24,"column":7,"index":659},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\public\\vendor\\css\\dc.css"},{"name":"/scss/main.scss","loc":{"line":25,"column":7,"index":697},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\scss\\main.scss"},{"name":"vue","loc":{"line":27,"column":16,"index":735},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\node_modules\\vue\\dist\\vue.esm.js"},{"name":"./components/Loader.vue","loc":{"line":28,"column":19,"index":762},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\components\\Loader.vue"},{"name":"./components/ChartHeader.vue","loc":{"line":29,"column":24,"index":814},"parent":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\tab_a.js","resolved":"C:\\Users\\tom.wright\\PycharmProjects\\UK_meetings_app\\ukapp\\integritywatch-uk\\src\\components\\ChartHeader.vue"}],"generated":{"js":"\"use strict\";\n\nvar _underscore = _interopRequireDefault(require(\"underscore\"));\nrequire(\"../public/vendor/js/popper.min.js\");\nrequire(\"../public/vendor/js/bootstrap.min.js\");\nvar _d3Request = require(\"d3-request\");\nrequire(\"../public/vendor/css/bootstrap.min.css\");\nrequire(\"../public/vendor/css/dc.css\");\nrequire(\"/scss/main.scss\");\nvar _vue = _interopRequireDefault(require(\"vue\"));\nvar _Loader = _interopRequireDefault(require(\"./components/Loader.vue\"));\nvar _ChartHeader = _interopRequireDefault(require(\"./components/ChartHeader.vue\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n//import jquery from 'jquery';\n//window.jQuery = jquery;\n//window.$ = jquery;\n//var jQuery = jquery;\n\nvar jquery = require('jquery');\n$ = window.$ = window.jQuery = jquery;\nrequire('jquery-ui-bundle');\nrequire('jquery-ui-bundle/jquery-ui.css');\nrequire('datatables.net')(window, $);\nrequire('datatables.net-dt')(window, $);\nwindow.underscore = _underscore.default;\nwindow._ = _underscore.default;\n//import 'jquery-ui-bundle';\n//import 'jquery-ui-bundle/jquery-ui.css';\n\n// Data object - is also used by Vue\n\nvar vuedata = {\n  page: 'tabA',\n  loader: true,\n  readMore: false,\n  showInfo: true,\n  showShare: true,\n  showAllCharts: true,\n  chartMargin: 40,\n  travelFilter: 'all',\n  charts: {\n    level: {\n      title: 'Role',\n      info: 'This pie chart shows the proportion of meetings hosted by political role. Click on the pie chart to filter the rest of the tool by role.'\n    },\n    department: {\n      title: 'Top 10 Public offices',\n      info: 'Filter by public office.'\n    },\n    hosts: {\n      title: 'TOP 10 HOSTS',\n      info: 'This bar chart shows the hosts who have had the most contact with lobby organisations. Click on the bar chart to filter the rest of the tool by host.\\n\\n Note: Due to issues with the source data, when UK Government hosts meet several lobby organisations in a single meeting, the tool counts it as one single meeting. The number of contacts with individual lobbyists can therefore be higher than the number of meetings diplayed on this portal.'\n    },\n    organizations: {\n      title: 'Top 10 Lobbyists',\n      info: 'This bar chart shows lobby organisations who have had the most contact with hosts in the UK Government, Scottish Government, and Scottish Parliament. Click on the bar chart to filter the rest of the tool by lobby organisation.\\n\\n Note: Due to issues with the source data, this is only a rough figure for exploring the data. When UK Government hosts meet several lobby organisations in a single meeting, the tool counts it as one single meeting. The number of contacts between lobbyists and hosts can therefore be higher than the number of meetings diplayed on this portal. Conversely, when lobbyists meet multiple hosts in the Scottish Government or Parliament at the same time, we have split them out into individual rows.'\n    },\n    mainTable: {\n      chart: null,\n      type: 'table',\n      title: 'Results',\n      info: 'This table presents a list of meetings based on the filters you apply. Use the filters above to refine this view.'\n    }\n  },\n  selectedElement: {\n    \"P\": \"\",\n    \"Sub\": \"\"\n  },\n  modalShowTable: '',\n  colors: {\n    //generic: [\"#3b95d0\", \"#4081ae\", \"#406a95\", \"#395a75\" ],\n    generic: [\"#981b48\", \"#b7255a\", \"#d73771\", \"#ec5189\", \"#ec7ca6\"],\n    //default: \"#2180c2\",\n    default: \"#d73771\",\n    default1: \"#3694d1\",\n    colorSchemeCloud: [\"#981b48\", \"#b7255a\", \"#d73771\", \"#ec5189\", \"#ec7ca6\", \"#f9b41b\", \"#e77a31\", \"#ffc138\"]\n    //colorSchemeCloud: [ \"#4d9e9c\", \"#62aad9\", \"#3b95d0\", \"#42b983\", \"#449188\", \"#52c993\", \"#b7bebf\", \"#99b6c0\" ]\n  }\n};\n\n//Set vue components and Vue app\n\n_vue.default.component('chart-header', _ChartHeader.default);\n_vue.default.component('loader', _Loader.default);\nnew _vue.default({\n  el: '#app',\n  data: vuedata,\n  methods: {\n    //Share\n    downloadDataset: function downloadDataset() {\n      window.open('./data/iw_uk.csv');\n    },\n    share: function share(platform) {\n      if (platform == 'twitter') {\n        var thisPage = window.location.href.split('?')[0];\n        var shareText = 'Who’s lobbying ministers and legislators across the UK, when and why? ' + thisPage;\n        var shareURL = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(shareText);\n        window.open(shareURL, '_blank');\n        return;\n      }\n      if (platform == 'facebook') {\n        var toShareUrl = 'https://openaccess.transparency.org.uk/';\n        var shareURL = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(toShareUrl);\n        window.open(shareURL, '_blank', 'toolbar=no,location=0,status=no,menubar=no,scrollbars=yes,resizable=yes,width=600,height=250,top=300,left=300');\n        return;\n      }\n    },\n    //Copy to clipboard\n    copyToClipboard: function copyToClipboard(elId) {\n      var textToCopy = document.getElementById(elId);\n      textToCopy.select();\n      textToCopy.setSelectionRange(0, 99999);\n      document.execCommand(\"copy\");\n      console.log(\"Copied: \" + textToCopy.value);\n    }\n  }\n});\n\n//Initialize info popovers\n$(function () {\n  $('[data-toggle=\"popover\"]').popover();\n});\n\n//Charts\nvar charts = {\n  level: {\n    chart: dc.pieChart(\"#level_chart\"),\n    type: 'pie',\n    divId: 'level_chart'\n  },\n  department: {\n    chart: dc.rowChart(\"#department_chart\"),\n    type: 'row',\n    divId: 'department_chart'\n  },\n  hosts: {\n    chart: dc.rowChart(\"#hosts_chart\"),\n    type: 'row',\n    divId: 'hosts_chart'\n  },\n  organizations: {\n    chart: dc.rowChart(\"#organizations_chart\"),\n    type: 'row',\n    divId: 'organizations_chart'\n  },\n  mainTable: {\n    chart: null,\n    type: 'table',\n    divId: 'dc-data-table'\n  }\n};\n\n//Functions for responsivness\nvar recalcWidth = function recalcWidth(divId) {\n  return document.getElementById(divId).offsetWidth - vuedata.chartMargin;\n};\nvar recalcCharsLength = function recalcCharsLength(width) {\n  return parseInt(width / 8);\n};\nvar calcPieSize = function calcPieSize(divId) {\n  var newWidth = recalcWidth(divId);\n  var sizes = {\n    'width': newWidth,\n    'height': 0,\n    'radius': 0,\n    'innerRadius': 0,\n    'cy': 0,\n    'legendY': 0\n  };\n  if (newWidth < 270) {\n    sizes.height = newWidth + 170;\n    sizes.radius = newWidth / 2;\n    sizes.innerRadius = newWidth / 4;\n    sizes.cy = newWidth / 2;\n    sizes.legendY = newWidth + 30;\n  } else {\n    sizes.height = newWidth * 0.75 + 170;\n    sizes.radius = newWidth * 0.75 / 2;\n    sizes.innerRadius = newWidth * 0.75 / 4;\n    sizes.cy = newWidth * 0.75 / 2;\n    sizes.legendY = newWidth * 0.75 + 30;\n  }\n  return sizes;\n};\nvar resizeGraphs = function resizeGraphs() {\n  for (var c in charts) {\n    if (c == 'subject' && vuedata.showAllCharts == false) {} else {\n      var sizes = calcPieSize(charts[c].divId);\n      var newWidth = recalcWidth(charts[c].divId);\n      var charsLength = recalcCharsLength(newWidth);\n      if (charts[c].type == 'row') {\n        charts[c].chart.width(newWidth);\n        charts[c].chart.label(function (d) {\n          var thisKey = d.key;\n          if (thisKey.indexOf('###') > -1) {\n            thisKey = thisKey.split('###')[0];\n          }\n          if (thisKey.length > charsLength) {\n            return thisKey.substring(0, charsLength) + '...';\n          }\n          return thisKey;\n        });\n        charts[c].chart.redraw();\n      } else if (charts[c].type == 'bar') {\n        charts[c].chart.width(newWidth);\n        charts[c].chart.rescale();\n        charts[c].chart.redraw();\n      } else if (charts[c].type == 'pie') {\n        charts[c].chart.width(sizes.width).height(sizes.height).cy(sizes.cy).innerRadius(sizes.innerRadius).radius(sizes.radius).legend(dc.legend().x(0).y(sizes.legendY).gap(10).legendText(function (d) {\n          var thisKey = d.name;\n          if (thisKey.length > charsLength) {\n            return thisKey.substring(0, charsLength) + '...';\n          }\n          return thisKey;\n        }));\n        charts[c].chart.redraw();\n      }\n    }\n  }\n};\n\n//Add commas to thousands\nfunction addcommas(x) {\n  if (parseInt(x)) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n  }\n  return x;\n}\n//Custom date order for dataTables\nvar dmy = d3.timeParse(\"%d/%m/%Y\");\njQuery.extend(jQuery.fn.dataTableExt.oSort, {\n  \"date-eu-pre\": function dateEuPre(date) {\n    if (date.indexOf(\"Cancelled\") > -1) {\n      date = date.split(\" \")[0];\n    }\n    return dmy(date);\n  },\n  \"date-eu-asc\": function dateEuAsc(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n  },\n  \"date-eu-desc\": function dateEuDesc(a, b) {\n    return a < b ? 1 : a > b ? -1 : 0;\n  }\n});\n\n//Get URL parameters\nfunction getParameterByName(name, url) {\n  if (!url) url = window.location.href;\n  name = name.replace(/[\\[\\]]/g, '\\\\$&');\n  var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n    results = regex.exec(url);\n  if (!results) return null;\n  if (!results[2]) return '';\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n}\n//Generate random parameter for dynamic dataset loading (to avoid caching)\nvar randomPar = '';\nvar randomCharacters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\nfor (var i = 0; i < 5; i++) {\n  randomPar += randomCharacters.charAt(Math.floor(Math.random() * randomCharacters.length));\n}\n//Load data and generate charts\nvar lobbyist_typeList = {};\nfetch('./data/iw_uk.json?' + randomPar).then(function (response) {\n  if (!response.ok) {\n    throw new Error('Network response was not ok');\n  }\n  return response.json();\n}).then(function (events) {\n  (0, _d3Request.csv)('./data/wdtk_departments.csv?' + randomPar, function (err, wdtkDepartments) {\n    var downloadStart = performance.now();\n    var parseDate = d3.timeParse(\"%d/%m/%Y\");\n    var now = Date.now();\n    //var RecordId = 0;\n    //Loop through data to aply fixes and calculations\n    _.each(events, function (d) {\n      if (!d.purpose) {\n        d.purpose = \"\";\n      }\n      //d.RecordId = RecordId;\n      d.date1 = d.date;\n      if (d.date != \"\") {\n        d.date = parseDate(d.date);\n      }\n      d.portfolio = '';\n      d.ministerialLevel = \"Others\";\n      switch (d.policy_level) {\n        case 1:\n          d.ministerialLevel = 'Minister';\n          break;\n        case 2:\n          d.ministerialLevel = 'MSP';\n          break;\n        case 3:\n          d.ministerialLevel = 'Special advisor';\n          break;\n        case 4:\n          d.ministerialLevel = 'Senior civil servant';\n          break;\n        default:\n          d.ministerialLevel = \"Others\";\n      }\n      ;\n      //RecordId ++;\n      var thisWdtkDep = _.find(wdtkDepartments, function (x) {\n        return x.dep == d.department;\n      });\n      if (thisWdtkDep) {\n        d.department_wdtk = thisWdtkDep.wdtk_name;\n      } else {\n        d.department_wdtk = '';\n      }\n      //Generated url for pre-filled request\n      var requestBaseUrl = 'https://www.whatdotheyknow.com/new/';\n      var orgString = d.organisation;\n      if (orgString.length > 400) {\n        orgString = orgString.slice(0, 400);\n        var lastWord = orgString.lastIndexOf(' ');\n        orgString = orgString.substring(0, lastWord) + ' ...';\n      }\n      var formTitle = encodeURI('FOI request: Meeting held on ' + d.date1 + ' with ' + d.rep_new + '.');\n      var formMessage = 'Could you please acknowledge my request is being considered.\\r\\n' + 'For the meeting held on ' + d.date1 + ' between ' + d.rep_new + ' and ' + orgString + ', with purpose ' + d.purpose + '\\r\\ncould you please provide the following information:\\r\\n\\r\\n' + '• A full list of attendees, including full names and titles as well as who the attendee represents\\r\\n' + '• A copy of the meeting agenda\\r\\n' + '• Meeting notes/minutes taken during the meeting, as well as any briefing notes and papers\\r\\n' + '• Any correspondence associated with the attendees, including debriefs of the meeting via email or other forms of communication.\\r\\n';\n      formMessage = encodeURI(formMessage);\n      d.requestFullUrl = requestBaseUrl + d.department_wdtk + '?title=' + formTitle + '&default_letter=' + formMessage;\n      //Meeting url\n      d.meetingUrl = window.location.href.split('?')[0] + '?meeting=' + d.RecordId;\n    });\n\n    //Set dc main vars. The second crossfilter is used to handle the travels stacked bar chart.\n    var ndx = crossfilter(events);\n    var downloadEnd = performance.now(); // End timing for download\n    var downloadTime = downloadEnd - downloadStart; // Calculate download time\n    console.log(\"data load: \" + downloadTime + \" milliseconds\");\n    var downloadStart = performance.now();\n    // Initialize Crossfilter with your dataset\n\n    var searchDimension = ndx.dimension(function (d) {\n      var entryString = d.rep_new + \" \" + d.organisation + \" \" + d.purpose + \" \" + d.policy_level + \" \" + d.department + \" \" + d.ministerialLevel + \" \" + d.registrant_additional_information;\n      return entryString.toLowerCase();\n    });\n    var dateEvent = ndx.dimension(function (d) {\n      if (!d.date) {\n        return \"\";\n      }\n      return d.date;\n    });\n\n    // Assuming this is placed inside your CSV loading callback, after initializing your crossfilter `ndx`\n    function exportFilteredData() {\n      // Assuming 'ndx' is your crossfilter instance\n      var allFilteredData = ndx.allFiltered(); // This retrieves all records that match the current filters\n\n      // Convert the filtered data to CSV format\n      var csvRows = [];\n      var headers = Object.keys(allFilteredData[0]);\n      csvRows.push(headers.join(',')); // Add header row\n\n      allFilteredData.forEach(function (row) {\n        var values = headers.map(function (header) {\n          return JSON.stringify(row[header]);\n        });\n        csvRows.push(values.join(','));\n      });\n      var csvData = csvRows.join('\\n');\n\n      // Trigger download\n      var blob = new Blob([csvData], {\n        type: 'text/csv;charset=utf-8;'\n      });\n      var url = URL.createObjectURL(blob);\n      var link = document.createElement(\"a\");\n      link.setAttribute(\"href\", url);\n      link.setAttribute(\"download\", 'filtered-data.csv');\n      link.style.visibility = 'hidden';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n\n    // Example: Bind the export function to a button click event\n    document.getElementById('exportButton').addEventListener('click', exportFilteredData);\n\n    // Assuming ndx is your Crossfilter instance and is already defined and initialized\n    // with your dataset somewhere in your script before this code block.\n\n    // Create a dimension based on the \"portal_source\" column\n    // Assuming ndx is already defined and is your crossfilter instance\n    var sourceDimension = ndx.dimension(function (d) {\n      return d.portal_source;\n    });\n\n    // Tracks which filters are currently active\n    var activeFilters = {\n      'Scottish lobbying register': false,\n      'UK Government': false\n    };\n\n    // Function to initialize button states and event listeners\n    function initializeButton(buttonId, filterValue) {\n      var button = document.getElementById(buttonId);\n      button.style.backgroundColor = '#D3D3D3'; // Default state for non-active filters\n\n      button.addEventListener('click', function () {\n        // Toggle the active state of the filter\n        activeFilters[filterValue] = !activeFilters[filterValue];\n        // Show loader immediately\n        _vue.default.set(vuedata, 'loader', true);\n        // Apply filters and update UI\n        requestAnimationFrame(function () {\n          applyFilters();\n        });\n      });\n    }\n\n    // Applies active filters to the dimension and updates the UI accordingly\n    function applyFilters() {\n      var activeFilterValues = Object.keys(activeFilters).filter(function (key) {\n        return activeFilters[key];\n      });\n\n      // Filter data based on active filters\n      if (activeFilterValues.length === 0) {\n        sourceDimension.filterAll();\n      } else {\n        sourceDimension.filter(function (d) {\n          return activeFilterValues.includes(d);\n        });\n      }\n\n      // Update button styles and disable loader after UI updates\n      setTimeout(function () {\n        updateButtonStyles();\n        _vue.default.set(vuedata, 'loader', false); // Hide loader after updating the UI\n        dc.redrawAll(); // Redraw charts with the new filter\n      }, 0);\n    }\n\n    // Updates the styles of buttons based on the active filters\n    function updateButtonStyles() {\n      Object.entries(activeFilters).forEach(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n          filterValue = _ref2[0],\n          isActive = _ref2[1];\n        var buttonId = filterValue === 'Scottish lobbying register' ? 'filter-source-button-scot' : 'filter-source-button-uk';\n        var button = document.getElementById(buttonId);\n        button.style.backgroundColor = isActive ? '#3694d1' : '#D3D3D3';\n        button.style.boxShadow = isActive ? '0 2px 4px rgba(0, 0, 0, 0.5)' : 'none';\n        button.disabled = false; // Re-enable the button after processing\n      });\n    }\n\n    // Initialize buttons with their respective filter values\n    initializeButton('filter-source-button-scot', 'Scottish lobbying register');\n    initializeButton('filter-source-button-uk', 'UK Government');\n    var tagDimension = ndx.dimension(function (d) {\n      return d.tag;\n    });\n\n    // Initial state of the filters\n    var activeFilters = [];\n\n    // Function to update the dimension filter based on active filters\n    function updateDimensionFilter() {\n      if (activeFilters.length === 0) {\n        tagDimension.filterAll();\n      } else {\n        tagDimension.filter(function (d) {\n          return activeFilters.includes(d);\n        });\n      }\n      dc.redrawAll();\n    }\n\n    // Function to toggle the filter state\n    function toggleFilterState(filter) {\n      var index = activeFilters.indexOf(filter);\n      if (index === -1) {\n        activeFilters.push(filter);\n      } else {\n        activeFilters.splice(index, 1);\n      }\n      updateDimensionFilter();\n    }\n    var filterIcons = {\n      Climate: 'leaf',\n      \"Financial Services\": 'piggy-bank',\n      Health: 'heart-pulse',\n      Technology: 'microchip',\n      Defence: 'shield-halved'\n    };\n    // Setup buttons\n    var filters = ['Climate', 'Financial Services', 'Health', 'Technology', 'Defence']; // Example filters\n    filters.forEach(function (filter) {\n      var button = document.createElement('button');\n      var iconName = filterIcons[filter];\n      button.innerHTML = \"<i class=\\\"fa fa-\".concat(iconName, \" icon-white\\\"></i>\"); // Apply 'icon-white' class\n      button.classList.add('filter-button');\n      button.dataset.filter = filter;\n      button.title = filter; // Set the tooltip text to the filter name\n\n      button.addEventListener('click', function () {\n        var _this = this;\n        // Disable button immediately to prevent multiple clicks\n        this.disabled = true;\n\n        // Use requestAnimationFrame to ensure loader is shown in the next frame\n        requestAnimationFrame(function () {\n          vuedata.loader = true; // Show loader\n\n          // Defer the rest of the logic\n          setTimeout(function () {\n            var filter = _this.dataset.filter;\n            toggleFilterState(filter);\n            _this.classList.toggle('active'); // Toggle a class that changes the button's appearance\n\n            if (_this.classList.contains('active')) {\n              _this.style.backgroundColor = '#3694d1'; // Example active color\n            } else {\n              _this.style.backgroundColor = ''; // Reset to default\n            }\n\n            // Schedule the UI update to hide the loader and re-enable the button\n            requestAnimationFrame(function () {\n              _this.disabled = false;\n              vuedata.loader = false;\n            });\n          }, 0); // Execute the deferred logic immediately after the current call stack clears\n        });\n      });\n      document.getElementById('filter-buttons').appendChild(button);\n    });\n\n    //chart 1\n    var createLevelChart = function createLevelChart() {\n      var order = ['Minister', 'MSP', 'Special advisor', 'Senior civil servant', 'Others'];\n      var chart = charts.level.chart;\n      var dimension = ndx.dimension(function (d) {\n        return d.ministerialLevel;\n      });\n      var group = dimension.group().reduceSum(function (d) {\n        return 1;\n      });\n      var sizes = calcPieSize(charts.level.divId);\n      chart.width(sizes.width).height(sizes.height).cy(sizes.cy).innerRadius(sizes.innerRadius).radius(sizes.radius).legend(dc.legend().x(0).y(sizes.legendY).gap(10).legendText(function (d) {\n        var thisKey = d.name;\n        if (thisKey.length > 40) {\n          return thisKey.substring(0, 40) + '...';\n        }\n        return thisKey;\n      })).title(function (d) {\n        var thisKey = d.key;\n        return thisKey + ': ' + d.value;\n      }).dimension(dimension).ordering(function (d) {\n        return order.indexOf(d.key);\n      }).ordinalColors([\"#981b48\", \"#b7255a\", \"#d73771\", \"#ec5189\", \"#ccc\"])\n      /*\r\n      .colorCalculator(function(d, i) {\r\n        return vuedata.colors.institutionsTypes[d.key];\r\n      })\r\n      */.group(group);\n      chart.render();\n    };\n\n    //CHART 2 Revised with Filtering and Limiting to 10 Maximum\n    var createDepartmentChart = function createDepartmentChart() {\n      var chart = charts.department.chart;\n      var dimension = ndx.dimension(function (d) {\n        return d.department;\n      });\n      var group = dimension.group().reduceSum(function (d) {\n        return 1;\n      });\n\n      // Filtering to exclude departments with no records and limit to top 10\n      var filteredGroup = function (source_group) {\n        return {\n          all: function all() {\n            return source_group.all().filter(function (d) {\n              return d.value != 0;\n            }).sort(function (a, b) {\n              return b.value - a.value; // Sort by value in descending order\n            }).slice(0, 10); // Take only the top 10\n          }\n        };\n      }(group);\n      var width = recalcWidth(charts.department.divId);\n      var charsLength = recalcCharsLength(width);\n      chart.width(width).height(420).margins({\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 20\n      }).group(filteredGroup) // Use the filtered and limited group\n      .dimension(dimension).colorCalculator(function (d, i) {\n        return vuedata.colors.default;\n      }).label(function (d) {\n        if (d.key && d.key.length > charsLength) {\n          return d.key.substring(0, charsLength) + '...';\n        }\n        return d.key;\n      }).title(function (d) {\n        return d.key + ': ' + d.value;\n      }).elasticX(true).xAxis().ticks(4);\n      chart.render();\n    };\n\n    //CHART 3\n    var createHostsChart = function createHostsChart() {\n      var chart = charts.hosts.chart;\n      var dimension = ndx.dimension(function (d) {\n        return d.rep_new;\n        ;\n      });\n      var group = dimension.group().reduceSum(function (d) {\n        return 1;\n      });\n      var filteredGroup = function (source_group) {\n        return {\n          all: function all() {\n            return source_group.top(10).filter(function (d) {\n              return d.value != 0;\n            });\n          }\n        };\n      }(group);\n      var width = recalcWidth(charts.hosts.divId);\n      var charsLength = recalcCharsLength(width);\n      chart.width(width).height(420).margins({\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 20\n      }).group(filteredGroup).dimension(dimension).colorCalculator(function (d, i) {\n        return vuedata.colors.default;\n      }).label(function (d) {\n        if (d.key && d.key.length > charsLength) {\n          return d.key.substring(0, charsLength) + '...';\n        }\n        return d.key;\n      }).title(function (d) {\n        return d.key + ': ' + d.value;\n      }).elasticX(true).xAxis().ticks(4);\n      //chart.xAxis().tickFormat(numberFormat);\n      chart.render();\n    };\n\n    //CHART 4\n    var createOrganizationsChart = function createOrganizationsChart() {\n      var chart = charts.organizations.chart;\n      var dimension = ndx.dimension(function (d) {\n        return d.organisation;\n      });\n      var group = dimension.group().reduceSum(function (d) {\n        return 1;\n      });\n      var filteredGroup = function (source_group) {\n        return {\n          all: function all() {\n            return source_group.top(10).filter(function (d) {\n              return d.value != 0;\n            });\n          }\n        };\n      }(group);\n      var width = recalcWidth(charts.organizations.divId);\n      var charsLength = recalcCharsLength(width);\n      chart.width(width).height(420).margins({\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 20\n      }).group(filteredGroup).dimension(dimension).colorCalculator(function (d, i) {\n        return vuedata.colors.default1;\n      }).label(function (d) {\n        if (d.key && d.key.length > charsLength) {\n          return d.key.substring(0, charsLength) + '...';\n        }\n        return d.key;\n      }).title(function (d) {\n        return d.key + ': ' + d.value;\n      }).elasticX(true).xAxis().ticks(4);\n      //chart.xAxis().tickFormat(numberFormat);\n      chart.render();\n    };\n\n    //CHART 5\n\n    //TABLE\n    var createTable = function createTable() {\n      var count = 0;\n      charts.mainTable.chart = $(\"#dc-data-table\").dataTable({\n        \"columnDefs\": [{\n          \"searchable\": false,\n          \"orderable\": false,\n          \"targets\": 0,\n          data: function data(row, type, val, meta) {\n            return count;\n          }\n        }, {\n          \"searchable\": false,\n          \"orderable\": true,\n          \"targets\": 1,\n          \"defaultContent\": \"N/A\",\n          \"data\": function data(d) {\n            //id,function,party,institution,date,contact_type,org_name,lobbyist_type,purpose,purpose_details\n            return d.rep_new;\n          }\n        }, {\n          \"searchable\": false,\n          \"orderable\": true,\n          \"targets\": 2,\n          \"defaultContent\": \"N/A\",\n          \"data\": function data(d) {\n            return d.policy_level;\n          }\n        }, {\n          \"searchable\": false,\n          \"orderable\": true,\n          \"targets\": 3,\n          \"defaultContent\": \"N/A\",\n          \"data\": function data(d) {\n            return d.department;\n          }\n        }, {\n          \"searchable\": false,\n          \"orderable\": true,\n          \"targets\": 4,\n          \"defaultContent\": \"N/A\",\n          \"data\": function data(d) {\n            return d.purpose.replace(/\\n/g, \"<br>\");\n            return d.purpose;\n          }\n        }, {\n          \"searchable\": false,\n          \"orderable\": true,\n          \"targets\": 5,\n          \"defaultContent\": \"N/A\",\n          \"data\": function data(d) {\n            return d.organisation;\n          }\n        }, {\n          \"searchable\": false,\n          \"orderable\": true,\n          \"targets\": 6,\n          \"defaultContent\": \"N/A\",\n          \"type\": \"date-eu\",\n          \"data\": function data(d) {\n            if (!d.date) {\n              return d.date1;\n            }\n            return d.date.getDate() + \"/\" + (1 + d.date.getMonth()) + \"/\" + d.date.getFullYear();\n          }\n        }],\n        \"iDisplayLength\": 25,\n        \"bPaginate\": true,\n        \"bLengthChange\": true,\n        \"bFilter\": false,\n        \"order\": [[6, \"desc\"]],\n        \"bSort\": true,\n        \"bInfo\": true,\n        \"bAutoWidth\": false,\n        \"bDeferRender\": true,\n        \"aaData\": searchDimension.top(Infinity),\n        \"bDestroy\": true\n      });\n      var datatable = charts.mainTable.chart;\n      datatable.on('draw.dt', function () {\n        var PageInfo = $('#dc-data-table').DataTable().page.info();\n        datatable.DataTable().column(0, {\n          page: 'current'\n        }).nodes().each(function (cell, i) {\n          cell.innerHTML = i + 1 + PageInfo.start;\n        });\n      });\n      datatable.DataTable().draw();\n      $('#dc-data-table tbody').on('click', 'tr', function () {\n        var data = datatable.DataTable().row(this).data();\n        vuedata.selectedElement = data;\n        $('#detailsModal').modal();\n      });\n    };\n    //REFRESH TABLE\n    function RefreshTable() {\n      dc.events.trigger(function () {\n        var alldata = searchDimension.top(Infinity);\n        charts.mainTable.chart.fnClearTable();\n        charts.mainTable.chart.fnAddData(alldata);\n        charts.mainTable.chart.fnDraw();\n      });\n    }\n\n    //SEARCH INPUT FUNCTIONALITY\n\n    var typingTimer;\n    var doneTypingInterval = 1000;\n    var $input = $(\"#search-input\");\n\n    // Keyup event to start the timer\n    $input.on('keyup', function () {\n      clearTimeout(typingTimer);\n      typingTimer = setTimeout(doneTyping, doneTypingInterval);\n    });\n\n    // Keydown event to clear the timer\n    $input.on('keydown', function () {\n      clearTimeout(typingTimer);\n    });\n    function doneTyping() {\n      var s = $input.val().toLowerCase();\n      // Extract phrases in quotation marks and individual words outside quotation marks\n      var phrases = s.match(/\"[^\"]+\"|\\S+/g) || [];\n      searchDimension.filter(function (d) {\n        var entry = d; // The current entry string to be searched\n        var allMatch = true; // Flag to keep track of whether all search terms match\n\n        phrases.forEach(function (phrase) {\n          var exactMatch = phrase.startsWith('\"') && phrase.endsWith('\"');\n          var searchPhrase = exactMatch ? phrase.slice(1, -1) : phrase;\n          if (exactMatch) {\n            // For exact phrase matches, check if the phrase exists in the entry as is\n            if (entry.indexOf(searchPhrase) === -1) allMatch = false;\n          } else {\n            // For non-exact (individual word) matches, ensure each word is present anywhere in the string\n            var words = searchPhrase.split(\" \");\n            words.forEach(function (word) {\n              if (entry.indexOf(word) === -1) allMatch = false;\n            });\n          }\n        });\n        return allMatch;\n      });\n      throttle();\n    }\n    var throttleTimer;\n    function throttle() {\n      window.clearTimeout(throttleTimer);\n      throttleTimer = window.setTimeout(function () {\n        dc.redrawAll();\n      }, 250);\n    }\n\n    //DATEPICKER FUNCTIONALITY\n    var inidate;\n    var enddate;\n    //Get current date for datepicker end date\n    var currentDate = function currentDate(sp) {\n      var today = new Date();\n      var dd = today.getDate();\n      var mm = today.getMonth() + 1;\n      var yyyy = today.getFullYear();\n      if (dd < 10) dd = '0' + dd;\n      if (mm < 10) mm = '0' + mm;\n      return dd + sp + mm + sp + yyyy;\n    };\n    //Initialize datepicker\n    var dateFormat = \"dd/mm/yy\",\n      from = $(\"#from\").datepicker({\n        defaultDate: \"01/01/2012\",\n        changeMonth: true,\n        dateFormat: \"dd/mm/yy\"\n      }).on(\"change\", function () {\n        to.datepicker(\"option\", \"minDate\", getDate(this));\n        inidate = getDate(this);\n      }),\n      to = $(\"#to\").datepicker({\n        defaultDate: currentDate(\"/\"),\n        changeMonth: true,\n        dateFormat: \"dd/mm/yy\"\n      }).on(\"change\", function () {\n        from.datepicker(\"option\", \"maxDate\", getDate(this));\n        enddate = getDate(this);\n      });\n    //Get date\n    function getDate(element) {\n      var date;\n      try {\n        date = $.datepicker.parseDate(dateFormat, element.value);\n      } catch (error) {\n        date = null;\n      }\n      return date;\n    }\n    //Set ini and end default dates\n    $(\"#from\").val('01/01/2012');\n    $(\"#to\").val(currentDate(\"/\"));\n    inidate = $(\"#from\").datepicker(\"getDate\");\n    enddate = $(\"#to\").datepicker(\"getDate\");\n\n    //Date filter\n    $(\"#datefilter\").click(function () {\n      dateEvent.filter(function (d) {\n        return d == \"\" || d.getTime() >= inidate.getTime() && d.getTime() <= enddate.getTime();\n      });\n      throttle();\n      var throttleTimer;\n      function throttle() {\n        window.clearTimeout(throttleTimer);\n        throttleTimer = window.setTimeout(function () {\n          dc.redrawAll();\n        }, 250);\n      }\n    });\n\n    // Reset charts and filters\n    var resetGraphs = function resetGraphs() {\n      for (var c in charts) {\n        if (charts[c].type !== 'table' && charts[c].chart.hasFilter()) {\n          charts[c].chart.filterAll();\n        }\n      }\n\n      // Resetting sourceDimension and tagDimension filters\n      sourceDimension.filter(null);\n\n      // Additional resets you might have\n      searchDimension.filter(null);\n      dateEvent.filter(null);\n      $('#search-input').val('');\n      // Clear the activeFilters array\n      activeFilters = [];\n      var buttons = document.getElementsByClassName('regbutton');\n\n      // Loop through the NodeList of selected elements\n      for (var i = 0; i < buttons.length; i++) {\n        // For each element, remove the 'active' class\n        buttons[i].classList.remove('active');\n        // Change the background color to #D3D3D3\n        buttons[i].style.backgroundColor = '#D3D3D3';\n      }\n      // Call the function that updates the dimension filter based on activeFilters\n      updateDimensionFilter();\n\n      // Reset all filter buttons to default state\n      filters.forEach(function (filter) {\n        var button = document.querySelector(\"[data-filter=\\\"\".concat(filter, \"\\\"]\"));\n        if (button) {\n          button.classList.remove('active');\n          button.style.backgroundColor = ''; // Reset to default, adjust as necessary\n        }\n      });\n\n      // Redraw all charts to reflect the current state\n      dc.redrawAll();\n    };\n\n    // Attaching the reset function to the reset button's click event\n    $('.reset-btn').click(function () {\n      var _this2 = this;\n      this.disabled = true;\n\n      // Use requestAnimationFrame to ensure loader is shown in the next frame\n      requestAnimationFrame(function () {\n        vuedata.loader = true; // Show loader\n\n        // Defer the rest of the logic\n        setTimeout(function () {\n          resetGraphs();\n\n          // Schedule the UI update to hide the loader and re-enable the button\n          requestAnimationFrame(function () {\n            _this2.disabled = false;\n            vuedata.loader = false;\n          });\n        }, 0); // Execute the deferred logic immediately after the current call stack clears\n      });\n    });\n    var downloadStart = performance.now();\n\n    //Render charts\n    createLevelChart();\n    var downloadEnd = performance.now(); // End timing for download\n    var downloadTime = downloadEnd - downloadStart; // Calculate download time\n    console.log(\"Download time level: \" + downloadTime + \" milliseconds\");\n    var downloadStart = performance.now();\n    createDepartmentChart();\n    var downloadEnd = performance.now(); // End timing for download\n    var downloadTime = downloadEnd - downloadStart; // Calculate download time\n    console.log(\"department timze: \" + downloadTime + \" milliseconds\");\n    var downloadStart = performance.now();\n    createHostsChart();\n    var downloadEnd = performance.now(); // End timing for download\n    var downloadTime = downloadEnd - downloadStart; // Calculate download time\n    console.log(\"Download hosts: \" + downloadTime + \" milliseconds\");\n    var downloadStart = performance.now();\n    createOrganizationsChart();\n    var downloadEnd = performance.now(); // End timing for download\n    var downloadTime = downloadEnd - downloadStart; // Calculate download time\n    console.log(\"Download orgs: \" + downloadTime + \" milliseconds\");\n    var downloadStart = performance.now();\n    createTable();\n    var downloadEnd = performance.now(); // End timing for download\n    var downloadTime = downloadEnd - downloadStart; // Calculate download time\n    console.log(\"table timze: \" + downloadTime + \" milliseconds\");\n    $('.dataTables_wrapper').append($('.dataTables_length'));\n\n    //Toggle last charts functionality and fix for responsiveness\n    vuedata.showAllCharts = false;\n\n    //Hide loader\n    vuedata.loader = false;\n\n    //COUNTERS\n    //Main counter\n    var all = ndx.groupAll();\n    var counter = dc.dataCount('.dc-data-count').dimension(ndx).group(all);\n    counter.render();\n    //Update datatables\n    counter.on(\"renderlet.resetall\", function (c) {\n      RefreshTable();\n    });\n\n    //Lobbyists counter\n    function drawLobbyistsCounter() {\n      var dim = ndx.dimension(function (d) {\n        if (!d.organisation) {\n          return \"\";\n        } else {\n          return d.organisation;\n        }\n      });\n      var group = dim.group().reduce(function (p, d) {\n        p.nb += 1;\n        if (!d.organisation) {\n          return p;\n        }\n        return p;\n      }, function (p, d) {\n        p.nb -= 1;\n        if (!d.Id) {\n          return p;\n        }\n        return p;\n      }, function (p, d) {\n        return {\n          nb: 0\n        };\n      });\n      group.order(function (p) {\n        return p.nb;\n      });\n      var counter = dc.dataCount(\".count-box-orgs\").dimension(group).group({\n        value: function value() {\n          return group.all().filter(function (kv) {\n            if (kv.value.nb > 0) {}\n            return kv.value.nb > 0;\n          }).length;\n        }\n      }).renderlet(function (chart) {});\n      counter.render();\n    }\n    //drawLobbyistsCounter();\n\n    //Window resize function\n    window.onresize = function (event) {\n      resizeGraphs();\n    };\n\n    //After loading charts, load meeting if meeting parameter in url is present\n    if (getParameterByName('meeting')) {\n      var preselectedMeetingId = getParameterByName('meeting');\n      //Find meeting by id. If it exists set it as selectedElement and open modal\n      var preselectedMeeting = _.find(events, function (x) {\n        return x.RecordId == preselectedMeetingId;\n      });\n      if (preselectedMeeting) {\n        vuedata.selectedElement = preselectedMeeting;\n        $('#detailsModal').modal();\n      }\n    }\n  });\n}).catch(function (error) {\n  console.error('There was a problem with the fetch operation:', error);\n});\nfunction toggleDropup() {\n  var downloadDropdown = document.getElementById('download-dropdown'); // Target specific dropdown\n  if (window.innerWidth <= 992) {\n    downloadDropdown.classList.add('dropup');\n  } else {\n    downloadDropdown.classList.remove('dropup');\n  }\n}\n\n// Listen for window resize events\nwindow.addEventListener('resize', toggleDropup);\n\n// Initial check on page load\nwindow.addEventListener('DOMContentLoaded', toggleDropup);"},"sourceMaps":null,"error":null,"hash":"d93330c81a9c948071ace45b6bf5ba78","cacheData":{"env":{}}}